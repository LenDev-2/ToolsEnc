<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Serious Encryptor</title>
<style>
body{
  background:#020617;
  color:#e5e7eb;
  font-family:monospace;
  padding:20px;
}
textarea,input,button{
  width:100%;
  margin:8px 0;
  padding:10px;
  background:#020617;
  color:#e5e7eb;
  border:1px solid #334155;
}
button{cursor:pointer}
</style>
</head>
<body>

<h2>AES-256-GCM Encryptor</h2>

<textarea id="text" placeholder="Masukin teks"></textarea>
<input id="password" type="password" placeholder="Password (jangan tolol, yang kuat)">
<button onclick="encrypt()">ENCRYPT</button>
<button onclick="decrypt()">DECRYPT</button>
<textarea id="result" placeholder="Hasil"></textarea>

<script>
const enc = new TextEncoder();
const dec = new TextDecoder();

function bufToBase64(buf){
  return btoa(String.fromCharCode(...new Uint8Array(buf)));
}
function base64ToBuf(b64){
  return Uint8Array.from(atob(b64), c => c.charCodeAt(0));
}

async function deriveKey(password, salt){
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    enc.encode(password),
    "PBKDF2",
    false,
    ["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {
      name:"PBKDF2",
      salt,
      iterations:100000,
      hash:"SHA-256"
    },
    keyMaterial,
    { name:"AES-GCM", length:256 },
    false,
    ["encrypt","decrypt"]
  );
}

async function encrypt(){
  const text = document.getElementById("text").value;
  const pass = document.getElementById("password").value;
  if(!pass) return alert("Password kosong, jangan males");

  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv   = crypto.getRandomValues(new Uint8Array(12));
  const key  = await deriveKey(pass, salt);

  const encrypted = await crypto.subtle.encrypt(
    { name:"AES-GCM", iv },
    key,
    enc.encode(text)
  );

  const output = {
    s: bufToBase64(salt),
    i: bufToBase64(iv),
    d: bufToBase64(encrypted)
  };

  document.getElementById("result").value =
    btoa(JSON.stringify(output));
}

async function decrypt(){
  const input = document.getElementById("text").value;
  const pass  = document.getElementById("password").value;
  if(!pass) return alert("Password kosong");

  try{
    const data = JSON.parse(atob(input));
    const salt = base64ToBuf(data.s);
    const iv   = base64ToBuf(data.i);
    const encd = base64ToBuf(data.d);

    const key = await deriveKey(pass, salt);
    const decrypted = await crypto.subtle.decrypt(
      { name:"AES-GCM", iv },
      key,
      encd
    );

    document.getElementById("result").value =
      dec.decode(decrypted);
  }catch(e){
    alert("Password salah atau data rusak. Maksa amat.");
  }
}
</script>

</body>
  </html>
